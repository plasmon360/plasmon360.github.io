
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">

  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">
  <link rel="stylesheet" type="text/css" href="/theme/academicons-1.8.6/css/academicons.min.css">







<meta name="author" content="Bala Juluri" />
<meta name="description" content="Following is the jupyter notebook code for generating the plots shown here. Import the required modules import tabula import requests import datetime import geopandas as gpd import pandas as pd import json from dateutil import parser from bokeh.io import reset_output, output_notebook, show from bokeh.plotting import figure from bokeh …" />
<meta name="keywords" content="">


<meta property="og:site_name" content="Bala Juluri"/>
<meta property="og:title" content="Visualizaing Covid-19 Cases according to Zipcodes using Bokeh"/>
<meta property="og:description" content="Following is the jupyter notebook code for generating the plots shown here. Import the required modules import tabula import requests import datetime import geopandas as gpd import pandas as pd import json from dateutil import parser from bokeh.io import reset_output, output_notebook, show from bokeh.plotting import figure from bokeh …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/Covid-19_cases_in_sandiego_notebook.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-04-18 15:00:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/bala-juluri.html">
<meta property="article:section" content="Python, Bokeh"/>
<meta property="og:image" content="">

  <title>Bala Juluri &ndash; Visualizaing Covid-19 Cases according to Zipcodes using Bokeh</title>

</head>
<body>
  <aside>
    <div>
      <a href="">
        <img src="/theme/img/profile.png" alt="Bala Juluri" title="Bala Juluri">
      </a>

      <h1><a href="">Bala Juluri</a></h1>

    

     <p class="lead">I love tinkering with python, electronics and woodworking. </p>


      <ul class="social">
          <li>
            <a  class="sc-envelope" href="mailto:juluribk@gmail.com" target="_blank">
            <i class="fas fa-envelope">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/plasmon360" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="#" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-stack-overflow" href="https://stackoverflow.com/users/1753919/plasmon360?tab=topactivity" target="_blank">
            <i class="fab fa-stack-overflow">
            </i>
          </a></li>
          <li>
            <a  class="sc-google-scholar" href="https://scholar.google.com/citations?user=mfyb2u4AAAAJ&hl=en" target="_blank">
            <i class="ai ai-google-scholar">
            </i>
          </a></li>
      </ul>


    </div>



  </aside>
  <main>

    <nav>
      <a href="">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="Covid-19_cases_in_sandiego_notebook">Visualizaing Covid-19 Cases according to Zipcodes using Bokeh</h1>
    <p>
          Posted on Sat 18 April 2020 in <a href="/category/python-bokeh.html">Python, Bokeh</a>


    </p>
  </header>


  <div>
    <p>Following is the jupyter notebook code for generating the plots shown here. </p>
<h3>Import the required modules</h3>
<div class="highlight python"><pre><span></span><code><span class="kn">import</span> <span class="nn">tabula</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">reset_output</span><span class="p">,</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span>

<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Div</span><span class="p">,</span> <span class="n">Column</span>


<span class="c1">#make bokeh output to notebook</span>
<span class="n">reset_output</span><span class="p">()</span>
<span class="n">output_notebook</span><span class="p">()</span>
</code></pre></div>


<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1001">Loading BokehJS ...</span>
</div>

<h3>Download the Covid-19 case data from San Diego County</h3>
<div class="highlight python"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.sandiegocounty.gov/content/dam/sdc/hhsa/programs/phs/Epidemiology/COVID-19%20Summary</span><span class="si">%20o</span><span class="s1">f%20Cases%20by%20Zip%20Code.pdf&#39;</span>
<span class="n">pdf</span><span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;covid19_in_sd_{datetime.datetime.now().date()}.pdf&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>


<h3>Check if the pdf is downloaded</h3>
<div class="highlight python"><pre><span></span><code><span class="err">!</span><span class="n">ls</span> <span class="o">*.</span><span class="n">pdf</span>
</code></pre></div>


<div class="highlight mime"><pre><span></span><code><span class="err">covid19_in_sd_2020-04-18.pdf  covid19_in_sd_2020-04-20.pdf</span>
<span class="err">covid19_in_sd_2020-04-19.pdf</span>
</code></pre></div>


<h3>Read the pdf and clean up the data</h3>
<div class="highlight python"><pre><span></span><code><span class="k">def</span> <span class="nf">tabula_convert_pdf_to_df</span><span class="p">(</span><span class="n">pdf</span><span class="p">):</span>

    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">tabula</span><span class="o">.</span><span class="n">read_pdf</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">pages</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">tabula</span><span class="o">.</span><span class="n">read_pdf</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span><span class="n">pages</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># no use now</span>

    <span class="n">updated_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span><span class="p">))</span> <span class="c1"># no use now</span>

    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ZipCode&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;Zip Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;Zip Code.1&#39;</span><span class="p">]]),</span> 
                              <span class="s1">&#39;CaseCount&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">],</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;Count.1&#39;</span><span class="p">]])})[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>


    <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">df</span>


<span class="n">title</span><span class="p">,</span> <span class="n">count_data</span> <span class="o">=</span> <span class="n">tabula_convert_pdf_to_df</span><span class="p">(</span><span class="s1">&#39;covid19_in_sd_2020-04-20.pdf&#39;</span><span class="p">)</span>
</code></pre></div>


<h3>Get the geojson file of communities</h3>
<p>Later in this notebook, I want to plot the data on a map base on zip code geometry. I used the export geojson from https://data.sandiegocounty.gov/Maps-and-Geographical-Resources/Zip-Codes/vsuf-uefy to get the geojson file. In addition to the zip code geometry, it also has the name of the community it belongs to.</p>
<div class="highlight python"><pre><span></span><code><span class="n">county_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sandiego_Zip_Codes.geojson&#39;</span><span class="p">)</span>
<span class="n">county_gpd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>community</th>
      <th>shape_star</th>
      <th>shape_stle</th>
      <th>zip</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alpine</td>
      <td>4149939944.16</td>
      <td>326045.262676</td>
      <td>91901</td>
      <td>MULTIPOLYGON (((-116.74539 32.96063, -116.7408...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bonita</td>
      <td>273909416.836</td>
      <td>113257.374615</td>
      <td>91902</td>
      <td>MULTIPOLYGON (((-116.97172 32.70838, -116.9712...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Boulevard</td>
      <td>2735681408.51</td>
      <td>241725.552214</td>
      <td>91905</td>
      <td>MULTIPOLYGON (((-116.23165 32.75083, -116.2280...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Campo</td>
      <td>3066759065.62</td>
      <td>287410.325075</td>
      <td>91906</td>
      <td>MULTIPOLYGON (((-116.35677 32.70460, -116.3572...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Chula Vista</td>
      <td>403437442.009</td>
      <td>112587.791814</td>
      <td>91910</td>
      <td>MULTIPOLYGON (((-117.06354 32.65011, -117.0634...</td>
    </tr>
  </tbody>
</table>
</div>

<p>I then merge geojson zip code geometry data with case count data. I do a 'how =right' merge with the zip code as the common key. All the right rows (rows in case count per zip code) will be preserved.</p>
<div class="highlight python"><pre><span></span><code><span class="n">merged</span> <span class="o">=</span><span class="n">county_gpd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">count_data</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;ZipCode&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span>
                         <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;zip&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;community&#39;</span><span class="p">:</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">})</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CommunityName</th>
      <th>shape_star</th>
      <th>shape_stle</th>
      <th>geometry</th>
      <th>ZipCode</th>
      <th>CaseCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alpine</td>
      <td>4149939944.16</td>
      <td>326045.262676</td>
      <td>MULTIPOLYGON (((-116.74539 32.96063, -116.7408...</td>
      <td>91901</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bonita</td>
      <td>273909416.836</td>
      <td>113257.374615</td>
      <td>MULTIPOLYGON (((-116.97172 32.70838, -116.9712...</td>
      <td>91902</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Boulevard</td>
      <td>2735681408.51</td>
      <td>241725.552214</td>
      <td>MULTIPOLYGON (((-116.23165 32.75083, -116.2280...</td>
      <td>91905</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Chula Vista</td>
      <td>403437442.009</td>
      <td>112587.791814</td>
      <td>MULTIPOLYGON (((-117.06354 32.65011, -117.0634...</td>
      <td>91910</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Chula Vista</td>
      <td>329043951.316</td>
      <td>93108.6951441</td>
      <td>MULTIPOLYGON (((-117.04641 32.62846, -117.0463...</td>
      <td>91911</td>
      <td>98.0</td>
    </tr>
  </tbody>
</table>
</div>

<h2>Plot the case counts as function of zip code and community</h2>
<div class="highlight python"><pre><span></span><code><span class="n">nogeo_data</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[[</span><span class="s1">&#39;ZipCode&#39;</span><span class="p">,</span> <span class="s1">&#39;CaseCount&#39;</span><span class="p">,</span> <span class="s1">&#39;CommunityName&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
</code></pre></div>


<p>Split the communities into three parts to plot them seperately.</p>
<div class="highlight python"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">split0</span> <span class="o">=</span> <span class="n">nogeo_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nogeo_data</span><span class="p">[</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">]</span>

<span class="c1">## Split the all other remaining </span>
<span class="n">split1</span><span class="p">,</span> <span class="n">split2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">nogeo_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nogeo_data</span><span class="p">[</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># make groupby to create bokeh nested x range plots</span>
<span class="n">sandiego</span> <span class="o">=</span> <span class="n">split0</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">,</span> <span class="s1">&#39;ZipCode&#39;</span><span class="p">])</span>
<span class="n">part1</span> <span class="o">=</span> <span class="n">split1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">,</span> <span class="s1">&#39;ZipCode&#39;</span><span class="p">])</span>
<span class="n">part2</span> <span class="o">=</span> <span class="n">split2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CommunityName&#39;</span><span class="p">,</span> <span class="s1">&#39;ZipCode&#39;</span><span class="p">])</span>
</code></pre></div>


<div class="highlight python"><pre><span></span><code><span class="k">def</span> <span class="nf">create_plot</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
               <span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;CaseCount&quot;</span><span class="p">,</span> <span class="s2">&quot;@CaseCount_mean&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s2">&quot;Community Name, ZipCode&quot;</span><span class="p">,</span> <span class="s2">&quot;@CommunityName_ZipCode&quot;</span><span class="p">)]</span>
              <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;CommunityName_ZipCode&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;CaseCount_mean&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Case Count&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">22</span><span class="o">/</span><span class="mi">28</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">group_label_orientation</span> <span class="o">=</span> <span class="mi">22</span><span class="o">/</span><span class="mi">28</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;8pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">group_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;10pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;16pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;16pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;16pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;16pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">group_padding</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div>


<div class="highlight python"><pre><span></span><code><span class="n">show</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">Div</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>  <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;200%&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}),</span>
            <span class="n">create_plot</span><span class="p">(</span><span class="n">sandiego</span><span class="p">),</span> <span class="n">create_plot</span><span class="p">(</span><span class="n">part1</span><span class="p">),</span> <span class="n">create_plot</span><span class="p">(</span><span class="n">part2</span><span class="p">)))</span>
<span class="c1"># groupby are not sorted by bokeh. seems like a bug</span>
</code></pre></div>


<div class="bk-root" id="662d8d29-d834-43d8-b88e-2f960fad9cf9" data-root-id="5486"></div>

<h1>Chloropleth Map of Covid 19 cases according to Zip Code in San Diego</h1>
<div class="highlight python"><pre><span></span><code><span class="c1"># Convert merged data to json. Because there are some case counts from </span>
<span class="c1"># &quot;unknown&quot; they dont have any geo information.</span>

<span class="n">merged_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>

<span class="c1"># Convert to json to str like object because bokeh needs it in this form.</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">merged_json</span><span class="p">)</span>
</code></pre></div>


<div class="highlight python"><pre><span></span><code><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">GeoJSONDataSource</span><span class="p">,</span> <span class="n">LinearColorMapper</span><span class="p">,</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">HoverTool</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">brewer</span>

<span class="n">geosource</span> <span class="o">=</span> <span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">merged_json</span><span class="p">))</span>


<span class="c1">#Define a sequential multi-hue color palette.</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">brewer</span><span class="p">[</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>

<span class="c1">#Reverse color order </span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#Instantiate LinearColorMapper that linearly maps numbers in a range, into a sequence of colors.</span>
<span class="n">color_mapper</span> <span class="o">=</span> <span class="n">LinearColorMapper</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="n">palette</span><span class="p">,</span> <span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;CaseCount&#39;</span><span class="p">]))</span>

<span class="c1">#Create color bar. </span>
<span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">color_mapper</span><span class="p">,</span> <span class="n">label_standoff</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
<span class="n">border_line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">major_label_overrides</span> <span class="o">=</span> <span class="n">tick_labels</span><span class="p">)</span>

<span class="c1">#Add hover tool</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;CaseCount&#39;</span><span class="p">,</span><span class="s1">&#39;@CaseCount&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;Zip Code&#39;</span><span class="p">,</span> <span class="s1">&#39;@ZipCode&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;Community Name&#39;</span><span class="p">,</span> <span class="s1">&#39;@CommunityName&#39;</span><span class="p">)]</span>
                 <span class="p">)</span>

<span class="c1">#Create figure object.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
    <span class="n">x_axis_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_axis_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">plot_height</span> <span class="o">=</span> <span class="mi">1000</span> <span class="p">,</span> <span class="n">plot_width</span> <span class="o">=</span> <span class="mi">950</span><span class="p">,</span> 
           <span class="n">toolbar_location</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">hover</span><span class="p">])</span>

<span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1">#Add patch renderer to figure. </span>
<span class="n">p</span><span class="o">.</span><span class="n">patches</span><span class="p">(</span><span class="s1">&#39;xs&#39;</span><span class="p">,</span><span class="s1">&#39;ys&#39;</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">geosource</span><span class="p">,</span>
          <span class="n">fill_color</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field&#39;</span> <span class="p">:</span><span class="s1">&#39;CaseCount&#39;</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span> <span class="p">:</span> <span class="n">color_mapper</span><span class="p">},</span>
          <span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill_alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s1">&#39;16pt&#39;</span>
<span class="c1">#Specify figure layout.</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;above&#39;</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>


<div class="bk-root" id="c71f05ef-1509-4f9f-b355-11d854ce13e0" data-root-id="4530"></div>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Bala Juluri ",
  "url" : "",
  "image": "",
  "description": ""
}
</script>

</body>
</html>