<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Arbitrary 2d shapes in MEEP | Bala Juluri
</title>
  <link rel="canonical" href="./arbitrary-2d-shapes-in-meep.html">


  <link rel="stylesheet" href="./theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="./theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="./theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="./theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="plasmon360.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="plasmon360.github.io/feeds/plasmonics.atom.xml">  
  <meta name="description" content="In MEEP (1.1.1), dielectric structures are often created by constructive geometry (adding and subtracting primitive shapes). The primitive shapes that are allowed are blocks, cylinders, ellipsoids and cones. To create a complex shape, one has to decompose the geometry into these primitive shapes. Over the weekend, I was …">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-27406008-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="./">Bala Juluri</a></h1>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Arbitrary 2d shapes in MEEP
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2011-05-10T22:52:00-07:00">
          <i class="fas fa-clock"></i>
          Tue 10 May 2011
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="./category/plasmonics.html">Plasmonics</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="./tag/electromagnetism.html">#electromagnetism</a>,               <a href="./tag/fdtd.html">#FDTD</a>,               <a href="./tag/meep.html">#MEEP</a>,               <a href="./tag/octave.html">#octave</a>,               <a href="./tag/photonics.html">#photonics</a>,               <a href="./tag/plasmonics.html">#Plasmonics</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p><img alt="" class="center" src="./images/Arbirary_shapes-eps.png" title=""></p>
<p><a href="http://ab-initio.mit.edu/wiki/index.php/Meep">In MEEP (1.1.1)</a>, dielectric structures are often created by constructive geometry (adding and subtracting primitive shapes). The primitive shapes that are allowed are blocks, cylinders, ellipsoids and cones. To create a complex shape, one has to decompose the geometry into these primitive shapes. Over the weekend, I was wondering if it was possible to somehow create any complex shape in 2d without figuring out the exact positions and operations with the available primitive shapes. Here I report how I solve this problem.</p>
<p>The first thing I figured out was to create a 2d triangle with known vertices using a certain primitive shape. One can cut a cone to create a triangle, but that would limit me to isosceles triangle. My very smart colleague (<a href="http://www.esm.psu.edu/wiki/research:juh17:mengqian_lu">Mengqian Lu</a>) suggested me to cut a block/brick object with non-orthogonal axes such that you get a triangle. </p>
<p>In meep, block object requires, 
1) the lengths of the block edges along each of its three axes
2) the directions of the axes of the block and 
3)center. </p>
<p>A triangle with known (x1,y1,0), (x2,y2,0) and (x3,y3,0) can be represented with a block (with possible non-orthogonality) element by modifications as shown in the figure. I pick a random point "E" which is not in the plane of my triangle and assume it as origin of the block. Then the vectors corresponding to axes of block are given by EA, EB, EC vectors, sizes are given by |EA|,|EB|,|EC| and the center of the block is OE+0.5*(EA+EB+EC).</p>
<p>Triangle in Meep using block primitive object</p>
<p><img alt="" class="center" src="./images/Arbirary_shapes-single-triangle.png"></p>
<p>To test this, I wrote a octave code which produces a meep code that that can be executed to create a triangle with vertices of (-10,0,0), (10,0,0) and (0,10,0). The result of compiling the meep code and exporting the dielectric distribution is shown below. The length of the simulation domain is 20 units in both x and y directions.</p>
<p>Triangle shape implemented in meep using block primitve object.</p>
<p><img alt="" class="center" src="./images/Arbirary_shapes-single-triangle2.png"></p>
<p>With this information of incorporating a single triangle in meep, I can now obtain complex 2d shapes in meep. I start by writing a file that contains information regarding points that make up my structure and do a <a href="http://en.wikipedia.org/wiki/Delaunay_triangulation">constrained delaunay triangulation</a>. </p>
<p>One can use <a href="http://www.mathworks.com/products/matlab/demos.html?file=/products/demos/shipping/matlab/demoDelaunayTri.html">matlab (versions &gt;2009) to do such constrained delaunay triangulation</a>. However, many of us (poor graduate students :( ) do not have access to matlab. I figured out that constrained delaunay triangulation can be done by using <a href="http://www.cs.cmu.edu/~quake/triangle.html">Triangle package</a>, which is free. After I compile this code, I see two executables 1) Triangle and 2) Showme in my source folder. Triangle does the triangulation and showme does the visualization before and after triangulation.</p>
<p>First, I write a ".poly" file, to mention my structure. ”.poly” file contains information of the points that make up the structure, one has to also mention segments (the border of the polygon) and any holes (if present). More information can be <a href="http://www.cs.cmu.edu/~quake/triangle.delaunay.html">found here</a>. Once a poly file is written, it can visualized using showme executable . If everything is ok, then do a constrained delaunay triangulation using Triangle executable (beware of concavities). I again visualize the structure after triangulation using showme executable to check whether triangulation has happened correctly or not. Once triangulated, I use the method above to convert each triangle to a corresponding meep block element (with suitable centers, sizes and axes) and stitch all of them together (once again use a octave code to do that automatically).</p>
<p>Using the poly file for shape “A” obtained from <a href="http://people.sc.fsu.edu/~jburkardt/data/poly/a.poly">here</a> I create a dielectric structure in MEEP with each triangle representing a random dielectric constant. Below is the final result. This method can also be extended to a group of arbitrary shapes in one simulation each with different dielectric functions.  </p>
<p>Screenshot of showme executable showing the triangulation of 'A' shape.</p>
<p><img alt="" class="center" src="./images/Arbirary_shapes-screenshot.png"></p>
<p>'A' shaped dielectric structure in MEEP.
<img alt="" class="center" src="./images/Arbirary_shapes-eps.png" title=""></p>
<p>I seem to be missing my octave code for this implementation.</p>
<p>Here is a version posted by Felip BM </p>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span>out<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">MEEPtriangle</span><span class="p">(</span>p1,p2,p3<span class="p">);</span>
<span class="c">% Create a triangle in MEEP with vertices in p1, p2, p3</span>
<span class="c">% as explained in</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">juluribk</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2011</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">arbitrary</span><span class="o">-</span>2<span class="n">d</span><span class="o">-</span><span class="n">shapes</span><span class="o">-</span><span class="n">in</span><span class="o">-</span><span class="n">meep</span><span class="o">/</span>#<span class="n">comment</span><span class="o">-</span><span class="mi">54057</span>

<span class="c">%origin</span>
<span class="n">O</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c">% for now axes origin is a constant</span>

<span class="n">OA</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">p1</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O</span><span class="p">;</span>
<span class="n">OB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">p2</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O</span><span class="p">;</span>
<span class="n">OC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">p3</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O</span><span class="p">;</span>

<span class="c">% Origin of the triangle</span>
<span class="n">E</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="p">];</span><span class="c">% for now coords&#39; origin is a constant</span>
<span class="n">OE</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">O</span><span class="p">;</span>

<span class="c">% block edges and center</span>
<span class="n">EA</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">OA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OE</span><span class="p">;</span>
<span class="n">EB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">OB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OE</span><span class="p">;</span>
<span class="n">EC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">OC</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OE</span><span class="p">;</span>
<span class="n">CC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">OE</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">EA</span><span class="o">+</span><span class="n">EB</span><span class="o">+</span><span class="n">EC</span><span class="p">);</span><span class="w"> </span><span class="c">% center</span>

<span class="nb">fprintf</span><span class="p">([</span><span class="s">&#39;(make block (center %6.4f %6.4f %6.4f)\n\t\t&#39;</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;(size %6.4f %6.4f %6.4f)\n\t\t&#39;</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;(e1 %6.4f %6.4f %6.4f)\n\t\t&#39;</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;(e2 %6.4f %6.4f %6.4f)\n\t\t&#39;</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;(e3 %6.4f %6.4f %6.4f)\n\t\t&#39;</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;(material (make dielectric (epsilon 12))))&#39;</span><span class="p">],</span><span class="k">...</span><span class="c">% for now epsilon is constant</span>
<span class="w">        </span><span class="n">CC</span><span class="p">,</span><span class="nb">norm</span><span class="p">(</span><span class="n">EA</span><span class="p">),</span><span class="nb">norm</span><span class="p">(</span><span class="n">EB</span><span class="p">),</span><span class="nb">norm</span><span class="p">(</span><span class="n">EC</span><span class="p">),</span><span class="n">EA</span><span class="p">,</span><span class="n">EB</span><span class="p">,</span><span class="n">EC</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="./archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="./categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="./tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>