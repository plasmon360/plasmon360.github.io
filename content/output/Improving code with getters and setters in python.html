<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Better code using getters and setters in Python</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/electronics.html">Electronics</a></li>
                    <li><a href="/category/misc.html">Misc</a></li>
                    <li><a href="/category/plasmonics.html">Plasmonics</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/Improving code with getters and setters in python.html" rel="bookmark"
           title="Permalink to Better code using getters and setters in Python">Better code using getters and setters in Python</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-09-19T18:28:00+00:00">
                Published: Fri 19 September 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/juluribk.html">juluribk</a>
        </address>
<p>In <a href="/category/electronics.html">Electronics</a>.</p>

</footer><!-- /.post-info -->      <p>As I was moving from my wordpress website to pelican based static website, I noticed code for communication and control of <a href="">Pricenton Instrumments Acton SP2150i</a>.</p>
<p>As I looked at the the code, I noticed methods in the class such <code>get_nm</code> and <code>set_nm</code>. When I was writing that code, I didn't know about getting the functionality of getters and setters in python. Since then, I have been using getters and setters occasionally and thought everyone using python should be knowing about them.</p>
<p>Lets simply the original code to only few methods and implement getters and setters functionality.</p>
<p>#!python</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">visa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">SP2150i</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">get_instruments_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">=</span><span class="n">instrument</span><span class="p">(</span><span class="s1">&#39;COM7&#39;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#he default timeout is 5 sec, change the timeout if needed</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Check if monochromotor is connected to right COM port of instrument list.&quot;</span>

    <span class="k">def</span> <span class="nf">get_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">ask_for_values</span><span class="p">(</span><span class="s1">&#39;?FILTER&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span>

    <span class="k">def</span> <span class="nf">set_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span><span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">+</span> <span class="s1">&#39; FILTER&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s2">&quot;Filter changed and waiting with additional delay...&quot;</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Additional delay, just in case.</span>
            <span class="k">print</span> <span class="s2">&quot;Done waiting&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;There is no filter with this input&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1">#Create a object of the monochromator class</span>
    <span class="n">a</span><span class="o">=</span><span class="n">SP2150i</span><span class="p">()</span>

    <span class="c1"># request the filter currently used</span>
    <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">get_filter</span><span class="p">()</span>

    <span class="c1"># set the filter </span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># this applies the 320 nm filter in the beginning</span>
</pre></div>


<p>There are many filters in the instrument and one get the current filter that is in the path of light or set a different filter. <code>get_filter(self)</code> returns an attribute <code>self.filter</code> by <code>ask_for_values</code> method. <code>self.filter</code> holds the current filter value. <code>set_filter(num)</code> uses 'ask' method (think of ask here as writing to instrument) to set the filter to a different number. In this method I also check to make sure filter 'num' be always less than 6.</p>
<p>When the user needs the functionality of getting the current filter in the instrument or setting the filter to different type, he has to use lengthy <code>a.get_filter()</code> and <code>a.set_filter(num = x)</code> methods. </p>
<p>It would be better if the user can access the current filter by typing a.filter and it should return the current filter. This can be achieved by using a "property" decorator. The "property" decorator makes a method behave like an attribute. So if I added "property" decorator to <code>def filter(self): ...</code>, then when user prints or accesses a.filter then it executes a.filter() method. In this method, we can write our logic to get the current filter in the monochromator.</p>
<p>It would be also better if the  user can use <code>self.filter = 3</code>, which will set the filter to 3. This can be achieved with "filter.setter" decorator on top of <code>def filter(self,num):</code> method. If we did that, we could have a problem where user can set any value to the filter by saying a.filter = 100, however there is no filter "100". So we need to check if filter num is correct or not. If not correct, we raise an exception. </p>
<p>So the new code is as follows. </p>
<p>#!python</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">visa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">SP2150i</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">=</span><span class="n">instrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#he default timeout is 5 sec, change the timeout if needed</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Check if monochromotor is connected to right COM port&quot;</span>


    <span class="nd">@property</span> <span class="c1">#Read this as `by adding a property decorator on this mthod, when object.filter is accessed, object.filter() is returned`</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">ask_for_values</span><span class="p">(</span><span class="s1">&#39;?FILTER&#39;</span><span class="p">)</span>

    <span class="nd">@filter.setter</span> <span class="c1">#Reads this as `by adding filter.settter decorator, when object.filter = num is executed, object.filter(num) is returned`</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span><span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span><span class="o">+</span> <span class="s1">&#39; FILTER&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s2">&quot;Filter changed and waiting with additional delay...&quot;</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Additional delay, just in case.</span>
            <span class="k">print</span> <span class="s2">&quot;Done waiting&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is no filter with this input&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1">#Create a object of the monochromator class</span>
    <span class="n">a</span><span class="o">=</span><span class="n">SP2150i</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;COM7&#39;</span><span class="p">)</span>

    <span class="c1"># set the filter will return 2</span>
    <span class="n">a</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># request the filter currently used will return 2</span>
    <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">filter</span>

    <span class="c1"># set the filter to unacceptable number</span>
    <span class="n">a</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># this will raise an exception.</span>
</pre></div>


<p>The getters and setters functionality is very useful to protect an attribute (data encapsulation). I don't think we need to declare self._filter (protected attribute) here because value of self.filter is always being set by instrument or returned by instrument. User does not have access to it through the object. In the case, where we indeed need data protection, we could do something like answer given by <a href="https://stackoverflow.com/a/36943813/1753919">Aaron Hall on stackoverflow</a>.</p>
<p>There are many areas where the code can be improved. Some of them are:</p>
<ul>
<li>Instead of putting the burden on user to specify the com port number. We can get the com port number by asking all serially connected instruments for their serial id and see which one matches the user given serial number.</li>
<li>Writing a threaded version so this monochromator execution does not block main thread</li>
<li>Instead of thread use coroutines aka asyncio?</li>
</ul>
<p>but thats for an another day.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>