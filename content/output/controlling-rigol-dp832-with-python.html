<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Controlling Rigol Dp832 with python</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/electronics.html">Electronics</a></li>
                    <li><a href="/category/misc.html">Misc</a></li>
                    <li><a href="/category/plasmonics.html">Plasmonics</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/controlling-rigol-dp832-with-python.html" rel="bookmark"
           title="Permalink to Controlling Rigol Dp832 with python">Controlling Rigol Dp832 with python</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-05-08T17:08:00+00:00">
                Published: Fri 08 May 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/juluribk.html">juluribk</a>
        </address>
<p>In <a href="/category/electronics.html">Electronics</a>.</p>
<p>tags: <a href="/tag/instrumentation.html">Instrumentation</a> <a href="/tag/python.html">python</a> </p>
</footer><!-- /.post-info -->      <p>DC power supplies are very handy for electronic projects. They help to apply bias/voltage to a device. Controlling it by a computer by a program is helpful in advanced projects where timing and accurate control is an issue. </p>
<p>I got my hands on a RIGOL DP832 which is three channel (two 30V and one 5V) power supply and is programmable through SCPI commands. The device can be controlled by USB and rs232 (optionally by LAN). SCPI commands can be sent to the instruments using VISA interface. I used Python and pyvisa module to communicate with it. I wrote a class with basic functionality. Currently it has a console application and turning on and off at aÂ  particular bias and current value on a specified channel.</p>
<p>You can add more methods to the class for advanced features. You can see those commands in the <a href="http://www.batronix.com/pdf/Rigol/ProgrammingGuide/DP800_ProgrammingGuide_EN.pdf">programming manual</a>.</p>
<div class = "alert alert-primary">
<strong> Note: </strong> Download this gist from <a href = "https://gist.github.com/plasmon360/3204dc28deddeefe42d5"> my gihub </a>
</div>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat Dec 21 13:57:32 2013</span>

<span class="sd">@author: bjuluri</span>
<span class="sd">Uses Pyvisa for commounication</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">visa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">sys</span>


<span class="k">class</span> <span class="nc">Rigoldp832</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb_serial</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_list</span> <span class="o">=</span> <span class="n">get_instruments_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usb_address</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_list</span> <span class="k">if</span> <span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;USB&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="n">usb_serial</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>  <span class="c1"># Search a instrument with USB and serial number in the instrument list</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb_address</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Not Connected&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb_address</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">instrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usb_address</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Connected&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connected_with</span> <span class="o">=</span> <span class="s1">&#39;USB&#39;</span>
        <span class="k">except</span> <span class="n">VisaIOError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Not Connected&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;Pyvisa is not able to find the connections&quot;</span>


    <span class="k">def</span> <span class="nf">mywrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s1">&#39;SYST:ERR?&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">print</span> <span class="n">message</span><span class="o">+</span><span class="s1">&#39; recieved. No error occured&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">print</span> <span class="n">message</span><span class="o">+</span><span class="s1">&#39; recieved. An Error occured: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;resets the instrument, registers,buffers&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">close_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">i_protection_level</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:INST CH{channel}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">channel</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:CURR {i}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:CURR:PROT {i_level}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_level</span> <span class="o">=</span> <span class="n">i_protection_level</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:CURR:PROT:STAT ON&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:VOLT {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">turn_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:OUTP CH{channel},OFF&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">turn_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mywrite</span><span class="p">(</span><span class="s1">&#39;:OUTP CH{channel},ON&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        opens a console to send commands. See the commands in the user manual.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">cmd</span> <span class="o">!=</span> <span class="s1">&#39;exit()&#39;</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s1">&#39;Rigol DP832 console, Type exit() to leave&gt; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">answer</span>
            <span class="k">elif</span> <span class="n">cmd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cmd</span> <span class="o">!=</span> <span class="s1">&#39;exit()&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Exiting the Rigol DP832 console&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rigoldp832</span><span class="p">(</span><span class="n">usb_serial</span><span class="o">=</span><span class="s1">&#39;your_Serial_number&#39;</span><span class="p">)</span>

    <span class="c1">#To start a console</span>
    <span class="c1">#r.console()</span>

    <span class="c1"># This will reset the instrument, apply a bias of 1 V wih 0.1A of protection current for 10 sec and then turn off</span>
    <span class="n">r</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set_bias</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">i_protection_level</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">turn_on</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">turn_off</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">close_instrument</span><span class="p">()</span>
</pre></div>
</td></tr></table>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>